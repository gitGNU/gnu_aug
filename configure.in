#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ(2.56)
AC_INIT([src/config.h.in])

AM_INIT_AUTOMAKE([aug], [trunk], [mark@emantic.co.uk])
AC_CONFIG_HEADER([src/config.h])
AM_MAINTAINER_MODE

# Checks for programs.
AC_PROG_CXX
AC_PROG_CC
AC_PROG_CPP
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET

AC_LIBTOOL_WIN32_DLL
AM_PROG_LIBTOOL

AC_ARG_ENABLE(cppbuild,
    [  --enable-cppbuild       enable cpp build @<:@default=yes@:>@],
    cppbuild=$enableval)

AC_ARG_ENABLE(threads,
    [  --enable-threads        enable thread support @<:@default=yes@:>@],
    threads=$enableval)

AM_CONDITIONAL(ENABLE_CPPBUILD, test "$cppbuild" != "no")

# Checks for libraries.

LDFLAGS="-lm $LDFLAGS"

case $host in
*-*-cygwin* | *-*-mingw*)

    LDFLAGS="-lws2_32 -liphlpapi $LDFLAGS"
    LIBS="$LIBS -Wl,-lws2_32 -Wl,-liphlpapi"

    if test "$threads" != "no"; then
        CFLAGS="-mthreads -D_MT $CFLAGS"
        CXXFLAGS="-mthreads -D_MT $CXXFLAGS"
        LDFLAGS="-mthreads $LDFLAGS"
    fi

    CFLAGS="$CFLAGS -DWINVER=0x0501"
    CXXFLAGS="$CXXFLAGS -DWINVER=0x0501"
    ;;
*)
    AC_SEARCH_LIBS(gethostbyname, nsl)
    AC_SEARCH_LIBS(gethostname, nsl)
    AC_SEARCH_LIBS(socket, socket)

    if test "$threads" != "no"; then
        CFLAGS="-pthread -D_MT $CFLAGS"
        CXXFLAGS="-pthread -D_MT $CXXFLAGS"
        LDFLAGS="-pthread $LDFLAGS"
    fi
    ;;
esac

CFLAGS="$CFLAGS -D_POSIX_SOURCE -D_BSD_SOURCE"

# Checks for libraries.

# Checks for header files.
AC_FUNC_ALLOCA
AC_HEADER_STDC
AC_CHECK_HEADERS([arpa/inet.h fcntl.h inttypes.h limits.h malloc.h netdb.h netinet/in.h stddef.h stdlib.h string.h strings.h sys/ioctl.h sys/param.h sys/socket.h sys/time.h sys/timeb.h unistd.h])

# Checks for typedefs, structures, and compiler characteristics.
AC_HEADER_STDBOOL
AC_TYPE_MODE_T
AC_TYPE_OFF_T
AC_TYPE_PID_T
AC_TYPE_SIZE_T
AC_HEADER_TIME
AC_STRUCT_TM

# Checks for library functions.
AC_FUNC_ERROR_AT_LINE
AC_FUNC_FORK
AC_PROG_GCC_TRADITIONAL
AC_FUNC_MALLOC
AC_FUNC_MEMCMP
AC_FUNC_MMAP
AC_FUNC_REALLOC
AC_FUNC_SELECT_ARGTYPES
AC_TYPE_SIGNAL
AC_FUNC_STAT
AC_FUNC_STRFTIME
AC_FUNC_VPRINTF
AC_CHECK_FUNCS([atexit bzero dup2 ftruncate getcwd getpagesize gettimeofday localtime_r memchr memmove memset munmap pathconf realpath select socket strcasecmp strchr strerror strncasecmp strrchr strspn strtoul])

AC_CHECK_FUNC(strlcpy,
    [AC_DEFINE(HAVE_STRLCPY, 1,
        [Define to 1 if you have the `strlcpy' function.])
    ])

AC_CONFIG_FILES([Makefile
                 doc/Makefile
                 doc/man/Makefile
                 example/Makefile
                 example/cpp/Makefile
                 example/httpd/Makefile
                 src/Makefile
                 src/c/Makefile
                 src/c/augmar/Makefile
                 src/c/augnet/Makefile
                 src/c/augres/Makefile
                 src/c/augsrv/Makefile
                 src/c/augsrv/posix/Makefile
                 src/c/augsrv/win32/Makefile
                 src/c/augsys/Makefile
                 src/c/augsys/posix/Makefile
                 src/c/augsys/win32/Makefile
                 src/c/augutil/Makefile
                 src/c/mar/Makefile
                 src/cpp/Makefile
                 src/cpp/augmarpp/Makefile
                 src/cpp/augnetpp/Makefile
                 src/cpp/augsrvpp/Makefile
                 src/cpp/augsyspp/Makefile
                 src/cpp/augutilpp/Makefile
                 src/pl/Makefile
                 src/sh/Makefile
                 vc7/Makefile])
AC_OUTPUT
